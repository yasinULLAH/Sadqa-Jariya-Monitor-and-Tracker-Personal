
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jariyah Projects Monitor</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #1a252f;
            --text: #333;
            --card-bg: rgba(255, 255, 255, 0.85);
        }
        
        .dark-theme {
            --primary: #375a7f;
            --secondary: #2c82c9;
            --success: #00bc8c;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #303030;
            --dark: #222;
            --text: #fff;
            --card-bg: rgba(48, 48, 48, 0.85);
        }
        
        .nature-theme {
            --primary: #2d572c;
            --secondary: #3e884f;
            --success: #27ae60;
            --warning: #e67e22;
            --danger: #c0392b;
            --light: #f0f5e9;
            --dark: #1e3a1d;
            --text: #2c3e50;
            --card-bg: rgba(240, 245, 233, 0.85);
        }
        
        .water-theme {
            --primary: #1a5276;
            --secondary: #3498db;
            --success: #16a085;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ebf5fb;
            --dark: #154360;
            --text: #2c3e50;
            --card-bg: rgba(235, 245, 251, 0.85);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(120deg, var(--light), var(--secondary));
            background-attachment: fixed;
            min-height: 100vh;
        }
        
        h1, h2, h3, h4, h5, h6 {
            color: var(--primary);
            margin-bottom: 16px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            padding: 0 15px;
            margin: 0 auto;
        }
        
        .header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .nav-menu {
            display: flex;
            gap: 20px;
        }
        
        .nav-item {
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .nav-item:hover, .nav-item.active {
            background-color: var(--secondary);
        }
        
        .main {
            padding: 2rem 0;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background-color: var(--card-bg);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1rem;
            color: var(--text);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
            background-color: var(--secondary);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-primary { background-color: var(--primary); }
        .btn-secondary { background-color: var(--secondary); }
        .btn-success { background-color: var(--success); }
        .btn-warning { background-color: var(--warning); }
        .btn-danger { background-color: var(--danger); }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .tab {
            padding: 10px 15px;
            background-color: var(--light);
            color: var(--text);
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            border: none;
        }
        
        .tab.active {
            background-color: var(--secondary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .project-card {
            display: flex;
            flex-direction: column;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            background-color: var(--card-bg);
        }
        
        .project-header {
            padding: 15px;
            background-color: var(--primary);
            color: white;
        }
        
        .project-body {
            padding: 20px;
        }
        
        .project-footer {
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .progress-container {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--success);
            border-radius: 5px;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .table th {
            background-color: var(--primary);
            color: white;
        }
        
        .table tr:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: var(--light);
            margin: 50px auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary);
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .gallery-item {
            cursor: pointer;
            border-radius: 5px;
            overflow: hidden;
            height: 150px;
            position: relative;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        
        .gallery-item .overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .gallery-item:hover .overlay {
            opacity: 1;
        }
        
        .contact-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .contact-card {
            background-color: var(--card-bg);
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .theme-switcher {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .theme-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .theme-option.active {
            border-color: white;
            box-shadow: 0 0 0 2px var(--primary);
        }
        
        .theme-default { background: linear-gradient(120deg, #ecf0f1, #3498db); }
        .theme-dark { background: linear-gradient(120deg, #303030, #375a7f); }
        .theme-nature { background: linear-gradient(120deg, #f0f5e9, #3e884f); }
        .theme-water { background: linear-gradient(120deg, #ebf5fb, #3498db); }
        
        .export-options {
            display: flex;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-menu {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<header class="header">
<div class="container header-content">
<div class="logo">Jariyah Projects Monitor</div>
<div class="nav-menu">
<div class="nav-item active" data-tab="dashboard">Dashboard</div>
<div class="nav-item" data-tab="projects">Projects</div>
<div class="nav-item" data-tab="contacts">Contacts</div>
<div class="nav-item" data-tab="settings">Settings</div>
</div>
</div>
</header>

    <main class="main">
        <div class="container">
            <!-- Dashboard -->
            <section id="dashboard" class="tab-content active">
                <h2>Community Impact Dashboard</h2>
                
                <div class="dashboard">
                    <div class="stat-card">
                        <div class="stat-number" id="total-projects">0</div>
                        <div class="stat-label">Active Projects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-donations">$0</div>
                        <div class="stat-label">Total Donations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-donors">0</div>
                        <div class="stat-label">Donors</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="impact-metric">0</div>
                        <div class="stat-label">Lives Impacted</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Recent Projects</h3>
                    <div id="recent-projects">
                        <p>No projects found. Start by creating a new project.</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('add-project-modal')">Add New Project</button>
                </div>
                
                <div class="card">
                    <h3>Recent Activities</h3>
                    <div id="recent-activities">
                        <p>No recent activities.</p>
                    </div>
                </div>
            </section>
            
            <!-- Projects -->
            <section id="projects" class="tab-content">
                <h2>Projects</h2>
                
                <div class="tabs" id="project-tabs">
                    <button class="tab active" data-tab="all-projects">All Projects</button>
                    <button class="tab" data-tab="active-projects">Active</button>
                    <button class="tab" data-tab="completed-projects">Completed</button>
                    <button class="btn btn-primary" style="margin-left: auto;" onclick="openModal('add-project-modal')">Add New Project</button>
                </div>
                
                <div id="all-projects" class="tab-content active">
                    <div id="projects-list">
                        <p>No projects found. Start by creating a new project.</p>
                    </div>
                </div>
                
                <div id="active-projects" class="tab-content">
                    <div id="active-projects-list">
                        <p>No active projects found.</p>
                    </div>
                </div>
                
                <div id="completed-projects" class="tab-content">
                    <div id="completed-projects-list">
                        <p>No completed projects found.</p>
                    </div>
                </div>
            </section>
            
            <!-- Contacts -->
            <section id="contacts" class="tab-content">
                <h2>Contacts</h2>
                
                <div class="card">
                    <div class="form-group">
                        <input type="text" class="form-control" id="contact-search" placeholder="Search contacts...">
                    </div>
                    
                    <div id="contacts-list" class="contact-list">
                        <p>No contacts found. Add new contacts by creating donations or adding them manually.</p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="openModal('add-contact-modal')">Add New Contact</button>
                </div>
            </section>
            
            <!-- Settings -->
            <section id="settings" class="tab-content">
                <h2>Settings</h2>
                
                <div class="card">
                    <h3>Theme</h3>
                    <div class="theme-switcher">
                        <div class="theme-option theme-default active" data-theme="default"></div>
                        <div class="theme-option theme-dark" data-theme="dark"></div>
                        <div class="theme-option theme-nature" data-theme="nature"></div>
                        <div class="theme-option theme-water" data-theme="water"></div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Export Data</h3>
                    <div class="export-options">
                        <button class="btn btn-secondary" onclick="exportData('all')">Export All Data</button>
                        <button class="btn btn-secondary" onclick="exportData('projects')">Export Projects Only</button>
                        <button class="btn btn-secondary" onclick="exportData('contacts')">Export Contacts Only</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Clear Data</h3>
                    <p>Warning: This will delete all data stored in this application. This action cannot be undone.</p>
                    <button class="btn btn-danger" onclick="confirmClearData()">Clear All Data</button>
                </div>
            </section>
        </div>
    </main>
    
    <!-- Modals -->
    <!-- Add Project Modal -->
    <div id="add-project-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('add-project-modal')">&times;</span>
            <h2>Add New Project</h2>
            <form id="add-project-form">
                <div class="form-group">
                    <label for="project-name">Project Name</label>
                    <input type="text" class="form-control" id="project-name" required>
                </div>
                <div class="form-group">
                    <label for="project-type">Project Type</label>
                    <select class="form-control" id="project-type" required>
                        <option value="">Select Type</option>
                        <option value="water">Water Well</option>
                        <option value="orphan">Orphan Sponsorship</option>
                        <option value="education">Education</option>
                        <option value="tree">Tree Planting</option>
                        <option value="masjid">Masjid Construction</option>
                        <option value="food">Food Distribution</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="project-goal">Target Amount ($)</label>
                    <input type="number" class="form-control" id="project-goal" required min="1">
                </div>
                <div class="form-group">
                    <label for="project-description">Description</label>
                    <textarea class="form-control" id="project-description" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label for="project-impact">Expected Impact (number of people)</label>
                    <input type="number" class="form-control" id="project-impact" required min="1">
                </div>
                <div class="form-group">
                    <label for="project-location">Location</label>
                    <input type="text" class="form-control" id="project-location">
                </div>
                <button type="submit" class="btn btn-success">Create Project</button>
            </form>
        </div>
    </div>
    
    <!-- View Project Modal -->
    <div id="view-project-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('view-project-modal')">&times;</span>
            <div id="project-details-content"></div>
            
            <div class="tabs" id="project-details-tabs">
                <button class="tab active" data-project-tab="donations">Donations</button>
                <button class="tab" data-project-tab="expenses">Expenses</button>
                <button class="tab" data-project-tab="milestones">Milestones</button>
                <button class="tab" data-project-tab="photos">Photos</button>
                <button class="tab" data-project-tab="notes">Notes</button>
            </div>
            
            <div id="donations-tab" class="project-tab-content active">
                <div id="donations-list">
                    <p>No donations recorded yet.</p>
                </div>
                <button class="btn btn-primary" onclick="openAddDonationForm()">Add Donation</button>
                <div id="add-donation-form" style="display: none; margin-top: 15px;">
                    <h4>Add Donation</h4>
                    <form id="donation-form">
                        <div class="form-group">
                            <label for="donor-name">Donor Name</label>
                            <input type="text" class="form-control" id="donor-name" required>
                        </div>
                        <div class="form-group">
                            <label for="donation-amount">Amount ($)</label>
                            <input type="number" class="form-control" id="donation-amount" required min="1">
                        </div>
                        <div class="form-group">
                            <label for="donation-date">Date</label>
                            <input type="date" class="form-control" id="donation-date" required>
                        </div>
                        <div class="form-group">
                            <label for="donation-notes">Notes</label>
                            <textarea class="form-control" id="donation-notes" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Add Donation</button>
                    </form>
                </div>
            </div>
            
            <div id="expenses-tab" class="project-tab-content">
                <div id="expenses-list">
                    <p>No expenses recorded yet.</p>
                </div>
                <button class="btn btn-primary" onclick="openAddExpenseForm()">Add Expense</button>
                <div id="add-expense-form" style="display: none; margin-top: 15px;">
                    <h4>Add Expense</h4>
                    <form id="expense-form">
                        <div class="form-group">
                            <label for="expense-title">Title</label>
                            <input type="text" class="form-control" id="expense-title" required>
                        </div>
                        <div class="form-group">
                            <label for="expense-amount">Amount ($)</label>
                            <input type="number" class="form-control" id="expense-amount" required min="1">
                        </div>
                        <div class="form-group">
                            <label for="expense-date">Date</label>
                            <input type="date" class="form-control" id="expense-date" required>
                        </div>
                        <div class="form-group">
                            <label for="expense-notes">Notes</label>
                            <textarea class="form-control" id="expense-notes" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Add Expense</button>
                    </form>
                </div>
            </div>
            
            <div id="milestones-tab" class="project-tab-content">
                <div id="milestones-list">
                    <p>No milestones recorded yet.</p>
                </div>
                <button class="btn btn-primary" onclick="openAddMilestoneForm()">Add Milestone</button>
                <div id="add-milestone-form" style="display: none; margin-top: 15px;">
                    <h4>Add Milestone</h4>
                    <form id="milestone-form">
                        <div class="form-group">
                            <label for="milestone-title">Title</label>
                            <input type="text" class="form-control" id="milestone-title" required>
                        </div>
                        <div class="form-group">
                            <label for="milestone-date">Date</label>
                            <input type="date" class="form-control" id="milestone-date" required>
                        </div>
                        <div class="form-group">
                            <label for="milestone-description">Description</label>
                            <textarea class="form-control" id="milestone-description" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Add Milestone</button>
                    </form>
                </div>
            </div>
            
            <div id="photos-tab" class="project-tab-content">
                <div id="photos-gallery" class="gallery">
                    <p>No photos uploaded yet.</p>
                </div>
                <button class="btn btn-primary" onclick="openAddPhotoForm()">Add Photo</button>
                <div id="add-photo-form" style="display: none; margin-top: 15px;">
                    <h4>Add Photo</h4>
                    <form id="photo-form">
                        <div class="form-group">
                            <label for="photo-title">Title</label>
                            <input type="text" class="form-control" id="photo-title" required>
                        </div>
                        <div class="form-group">
                            <label for="photo-file">Photo</label>
                            <input type="file" class="form-control" id="photo-file" accept="image/*" required>
                        </div>
                        <div class="form-group">
                            <label for="photo-date">Date</label>
                            <input type="date" class="form-control" id="photo-date" required>
                        </div>
                        <div class="form-group">
                            <label for="photo-description">Description</label>
                            <textarea class="form-control" id="photo-description" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Add Photo</button>
                    </form>
                </div>
            </div>
            
            <div id="notes-tab" class="project-tab-content">
                <div id="notes-list">
                    <p>No notes added yet.</p>
                </div>
                <button class="btn btn-primary" onclick="openAddNoteForm()">Add Note</button>
                <div id="add-note-form" style="display: none; margin-top: 15px;">
                    <h4>Add Note</h4>
                    <form id="note-form">
                        <div class="form-group">
                            <label for="note-title">Title</label>
                            <input type="text" class="form-control" id="note-title" required>
                        </div>
                        <div class="form-group">
                            <label for="note-content">Content</label>
                            <textarea class="form-control" id="note-content" rows="4" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Add Note</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Contact Modal -->
    <div id="add-contact-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('add-contact-modal')">&times;</span>
            <h2>Add New Contact</h2>
            <form id="add-contact-form">
                <div class="form-group">
                    <label for="contact-name">Name</label>
                    <input type="text" class="form-control" id="contact-name" required>
                </div>
                <div class="form-group">
                    <label for="contact-email">Email</label>
                    <input type="email" class="form-control" id="contact-email">
                </div>
                <div class="form-group">
                    <label for="contact-phone">Phone</label>
                    <input type="tel" class="form-control" id="contact-phone">
                </div>
                <div class="form-group">
                    <label for="contact-type">Type</label>
                    <select class="form-control" id="contact-type" required>
                        <option value="donor">Donor</option>
                        <option value="volunteer">Volunteer</option>
                        <option value="beneficiary">Beneficiary</option>
                        <option value="partner">Partner Organization</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contact-notes">Notes</label>
                    <textarea class="form-control" id="contact-notes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Add Contact</button>
            </form>
        </div>
    </div>
    
    <!-- View Photo Modal -->
    <div id="view-photo-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('view-photo-modal')">&times;</span>
            <div id="photo-details"></div>
        </div>
    </div>
    
    <script>
        // Database initialization
        let db;
        const DB_NAME = 'JariyahProjectsDB';
        const DB_VERSION = 1;
        
        // Store names
        const PROJECTS_STORE = 'projects';
        const DONATIONS_STORE = 'donations';
        const EXPENSES_STORE = 'expenses';
        const MILESTONES_STORE = 'milestones';
        const CONTACTS_STORE = 'contacts';
        const PHOTOS_STORE = 'photos';
        const NOTES_STORE = 'notes';
        const ACTIVITIES_STORE = 'activities';
        
        // Current project ID for modals
        let currentProjectId = null;
        
        // Initialize the database
        function initDb() {
            return new Promise((resolve, reject) => {
                const req = indexedDB.open(DB_NAME, DB_VERSION);
                
                req.onerror = (event) => {
                    console.error('Database error:', event.target.error);
                    reject('Could not open database');
                };
                
                req.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('Database opened successfully');
                    resolve(db);
                };
                
                req.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Projects store
                    if (!db.objectStoreNames.contains(PROJECTS_STORE)) {
                        const projectsStore = db.createObjectStore(PROJECTS_STORE, { keyPath: 'id', autoIncrement: true });
                        projectsStore.createIndex('name', 'name', { unique: false });
                        projectsStore.createIndex('type', 'type', { unique: false });
                        projectsStore.createIndex('status', 'status', { unique: false });
                        projectsStore.createIndex('created', 'created', { unique: false });
                    }
                    
                    // Donations store
                    if (!db.objectStoreNames.contains(DONATIONS_STORE)) {
                        const donationsStore = db.createObjectStore(DONATIONS_STORE, { keyPath: 'id', autoIncrement: true });
                        donationsStore.createIndex('projectId', 'projectId', { unique: false });
                        donationsStore.createIndex('donorName', 'donorName', { unique: false });
                        donationsStore.createIndex('date', 'date', { unique: false });
                    }
                    
                    // Expenses store
                    if (!db.objectStoreNames.contains(EXPENSES_STORE)) {
                        const expensesStore = db.createObjectStore(EXPENSES_STORE, { keyPath: 'id', autoIncrement: true });
                        expensesStore.createIndex('projectId', 'projectId', { unique: false });
                        expensesStore.createIndex('date', 'date', { unique: false });
                    }
                    
                    // Milestones store
                    if (!db.objectStoreNames.contains(MILESTONES_STORE)) {
                        const milestonesStore = db.createObjectStore(MILESTONES_STORE, { keyPath: 'id', autoIncrement: true });
                        milestonesStore.createIndex('projectId', 'projectId', { unique: false });
                        milestonesStore.createIndex('date', 'date', { unique: false });
                    }
                    
                    // Contacts store
                    if (!db.objectStoreNames.contains(CONTACTS_STORE)) {
                        const contactsStore = db.createObjectStore(CONTACTS_STORE, { keyPath: 'id', autoIncrement: true });
                        contactsStore.createIndex('name', 'name', { unique: false });
                        contactsStore.createIndex('email', 'email', { unique: false });
                        contactsStore.createIndex('type', 'type', { unique: false });
                    }
                    
                    // Photos store
                    if (!db.objectStoreNames.contains(PHOTOS_STORE)) {
                        const photosStore = db.createObjectStore(PHOTOS_STORE, { keyPath: 'id', autoIncrement: true });
                        photosStore.createIndex('projectId', 'projectId', { unique: false });
                        photosStore.createIndex('date', 'date', { unique: false });
                    }
                    
                    // Notes store
                    if (!db.objectStoreNames.contains(NOTES_STORE)) {
                        const notesStore = db.createObjectStore(NOTES_STORE, { keyPath: 'id', autoIncrement: true });
                        notesStore.createIndex('projectId', 'projectId', { unique: false });
                        notesStore.createIndex('date', 'date', { unique: false });
                    }
                    
                    // Activities store
                    if (!db.objectStoreNames.contains(ACTIVITIES_STORE)) {
                        const activitiesStore = db.createObjectStore(ACTIVITIES_STORE, { keyPath: 'id', autoIncrement: true });
                        activitiesStore.createIndex('projectId', 'projectId', { unique: false });
                        activitiesStore.createIndex('date', 'date', { unique: false });
                        activitiesStore.createIndex('type', 'type', { unique: false });
                    }
                };
            });
        }
        
        // Generic DB operations
        function addToStore(storeName, data) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                const request = store.add(data);
                
                request.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                request.onerror = (event) => {
                    reject(event.target.error);
                };
            });
        }
        
        function updateInStore(storeName, data) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                const request = store.put(data);
                
                request.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                request.onerror = (event) => {
                    reject(event.target.error);
                };
            });
        }
        
        function getFromStore(storeName, id) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                const request = store.get(id);
                
                request.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                request.onerror = (event) => {
                    reject(event.target.error);
                };
            });
        }
        
        function getAllFromStore(storeName) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                const request = store.getAll();
                
                request.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                request.onerror = (event) => {
                    reject(event.target.error);
                };
            });
        }
        
        function deleteFromStore(storeName, id) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                const request = store.delete(id);
                
                request.onsuccess = (event) => {
                    resolve();
                };
                
                request.onerror = (event) => {
                    reject(event.target.error);
                };
            });
        }
        
        function getByIndex(storeName, indexName, value) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                const index = store.index(indexName);
                const request = index.getAll(value);
                
                request.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                request.onerror = (event) => {
                    reject(event.target.error);
                };
            });
        }
        
        // Project specific operations
        async function addProject(project) {
            project.created = new Date();
            project.status = 'active';
            
            try {
                const projectId = await addToStore(PROJECTS_STORE, project);
                
                // Log activity
                await addActivity({
                    projectId,
                    type: 'project_created',
                    description: `Project "${project.name}" created`,
                    date: new Date()
                });
                
                return projectId;
            } catch (error) {
                console.error('Error adding project:', error);
                throw error;
            }
        }
        
        async function getProject(id) {
            return getFromStore(PROJECTS_STORE, id);
        }
        
        async function getAllProjects() {
            return getAllFromStore(PROJECTS_STORE);
        }
        
        async function getActiveProjects() {
            return getByIndex(PROJECTS_STORE, 'status', 'active');
        }
        
        async function getCompletedProjects() {
            return getByIndex(PROJECTS_STORE, 'status', 'completed');
        }
        
        async function updateProject(project) {
            try {
                await updateInStore(PROJECTS_STORE, project);
                
                // Log activity
                await addActivity({
                    projectId: project.id,
                    type: 'project_updated',
                    description: `Project "${project.name}" updated`,
                    date: new Date()
                });
                
                return project.id;
            } catch (error) {
                console.error('Error updating project:', error);
                throw error;
            }
        }
        
        async function completeProject(id) {
            try {
                const project = await getProject(id);
                project.status = 'completed';
                project.completedDate = new Date();
                
                await updateInStore(PROJECTS_STORE, project);
                
                // Log activity
                await addActivity({
                    projectId: project.id,
                    type: 'project_completed',
                    description: `Project "${project.name}" marked as completed`,
                    date: new Date()
                });
                
                return project.id;
            } catch (error) {
                console.error('Error completing project:', error);
                throw error;
            }
        }
        
        // Donation operations
        async function addDonation(donation) {
            try {
                const donationId = await addToStore(DONATIONS_STORE, donation);
                
                // Update project funding
                const project = await getProject(donation.projectId);
                
                // Log activity
                await addActivity({
                    projectId: donation.projectId,
                    type: 'donation_received',
                    description: `Donation of $${donation.amount} received from ${donation.donorName}`,
                    date: new Date()
                });
                
                // Add or update contact if doesn't exist
                const contacts = await getByIndex(CONTACTS_STORE, 'name', donation.donorName);
                if (contacts.length === 0) {
                    await addToStore(CONTACTS_STORE, {
                        name: donation.donorName,
                        type: 'donor',
                        created: new Date(),
                        notes: `Added automatically from donation to ${project.name}`
                    });
                }
                
                return donationId;
            } catch (error) {
                console.error('Error adding donation:', error);
                throw error;
            }
        }
        
        async function getProjectDonations(projectId) {
            return getByIndex(DONATIONS_STORE, 'projectId', projectId);
        }
        
        // Expense operations
        async function addExpense(expense) {
            try {
                const expenseId = await addToStore(EXPENSES_STORE, expense);
                
                // Log activity
                await addActivity({
                    projectId: expense.projectId,
                    type: 'expense_added',
                    description: `Expense of $${expense.amount} added for ${expense.title}`,
                    date: new Date()
                });
                
                return expenseId;
            } catch (error) {
                console.error('Error adding expense:', error);
                throw error;
            }
        }
        
        async function getProjectExpenses(projectId) {
            return getByIndex(EXPENSES_STORE, 'projectId', projectId);
        }
        
        // Milestone operations
        async function addMilestone(milestone) {
            try {
                const milestoneId = await addToStore(MILESTONES_STORE, milestone);
                
                // Log activity
                await addActivity({
                    projectId: milestone.projectId,
                    type: 'milestone_added',
                    description: `Milestone reached: ${milestone.title}`,
                    date: new Date()
                });
                
                return milestoneId;
            } catch (error) {
                console.error('Error adding milestone:', error);
                throw error;
            }
        }
        
        async function getProjectMilestones(projectId) {
            return getByIndex(MILESTONES_STORE, 'projectId', projectId);
        }
        
        // Contact operations
        async function addContact(contact) {
            try {
                const contactId = await addToStore(CONTACTS_STORE, contact);
                
                // Log activity
                await addActivity({
                    type: 'contact_added',
                    description: `New contact added: ${contact.name}`,
                    date: new Date()
                });
                
                return contactId;
            } catch (error) {
                console.error('Error adding contact:', error);
                throw error;
            }
        }
        
        async function getAllContacts() {
            return getAllFromStore(CONTACTS_STORE);
        }
        
        // Photo operations
        async function addPhoto(photo) {
            try {
                const photoId = await addToStore(PHOTOS_STORE, photo);
                
                // Log activity
                await addActivity({
                    projectId: photo.projectId,
                    type: 'photo_added',
                    description: `New photo added: ${photo.title}`,
                    date: new Date()
                });
                
                return photoId;
            } catch (error) {
                console.error('Error adding photo:', error);
                throw error;
            }
        }
        
        async function getProjectPhotos(projectId) {
            return getByIndex(PHOTOS_STORE, 'projectId', projectId);
        }
        
        // Note operations
        async function addNote(note) {
            try {
                const noteId = await addToStore(NOTES_STORE, note);
                
                // Log activity
                await addActivity({
                    projectId: note.projectId,
                    type: 'note_added',
                    description: `New note added: ${note.title}`,
                    date: new Date()
                });
                
                return noteId;
            } catch (error) {
                console.error('Error adding note:', error);
                throw error;
            }
        }
        
        async function getProjectNotes(projectId) {
            return getByIndex(NOTES_STORE, 'projectId', projectId);
        }
        
        // Activity operations
        async function addActivity(activity) {
            return addToStore(ACTIVITIES_STORE, activity);
        }
        
        async function getRecentActivities(limit = 10) {
            const activities = await getAllFromStore(ACTIVITIES_STORE);
            return activities.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, limit);
        }
        
        // UI Operations
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-PK', { 
                style: 'currency', 
                currency: 'PKR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        async function refreshDashboard() {
            const projects = await getAllProjects();
            const activeProjects = projects.filter(p => p.status === 'active');
            
            // Update stats
            document.getElementById('total-projects').textContent = activeProjects.length;
            
            let totalDonations = 0;
            let totalDonors = new Set();
            let totalImpact = 0;
            
            // Calculate totals
            for (const project of projects) {
                const donations = await getProjectDonations(project.id);
                totalDonations += donations.reduce((sum, d) => sum + d.amount, 0);
                
                donations.forEach(d => totalDonors.add(d.donorName));
                
                if (project.impact) {
                    totalImpact += parseInt(project.impact);
                }
            }
            
            // Update dashboard stats
            document.getElementById('total-donations').textContent = formatCurrency(totalDonations);
            document.getElementById('total-donors').textContent = totalDonors.size;
            document.getElementById('impact-metric').textContent = totalImpact;
            
            // Recent projects
            const recentProjectsEl = document.getElementById('recent-projects');
            
            if (projects.length === 0) {
                recentProjectsEl.innerHTML = '<p>No projects found. Start by creating a new project.</p>';
            } else {
                const sortedProjects = [...projects].sort((a, b) => new Date(b.created) - new Date(a.created)).slice(0, 3);
                
                let html = '';
                for (const project of sortedProjects) {
                    const donations = await getProjectDonations(project.id);
                    const expenses = await getProjectExpenses(project.id);
                    
                    const totalRaised = donations.reduce((sum, d) => sum + d.amount, 0);
                    const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
                    const progress = (project.goal > 0) ? Math.min(100, Math.round((totalRaised / project.goal) * 100)) : 0;
                    
                    html += `
                        <div class="project-card">
                            <div class="project-header">
                                <h3>${project.name}</h3>
                            </div>
                            <div class="project-body">
                                <p>${project.description.length > 100 ? project.description.substring(0, 100) + '...' : project.description}</p>
                                <div class="progress-container">
                                    <div class="progress-bar" style="width: ${progress}%"></div>
                                </div>
                                <p><strong>Goal:</strong> ${formatCurrency(project.goal)} | <strong>Raised:</strong> ${formatCurrency(totalRaised)} (${progress}%)</p>
                            </div>
                            <div class="project-footer">
                                <span><strong>Status:</strong> ${project.status.charAt(0).toUpperCase() + project.status.slice(1)}</span>
                                <button class="btn btn-secondary" onclick="openProjectDetails(${project.id})">View Details</button>
                            </div>
                        </div>
                    `;
                }
                
                recentProjectsEl.innerHTML = html;
            }
            
            // Recent activities
            const recentActivitiesEl = document.getElementById('recent-activities');
            const activities = await getRecentActivities(5);
            
            if (activities.length === 0) {
                recentActivitiesEl.innerHTML = '<p>No recent activities.</p>';
            } else {
                let html = '<ul style="list-style-type: none; padding: 0;">';
                
                for (const activity of activities) {
                    let icon = '';
                    switch (activity.type) {
                        case 'project_created': icon = ''; break;
                        case 'project_updated': icon = ''; break;
                        case 'project_completed': icon = ''; break;
                        case 'donation_received': icon = ''; break;
                        case 'expense_added': icon = ''; break;
                        case 'milestone_added': icon = ''; break;
                        case 'photo_added': icon = ''; break;
                        case 'note_added': icon = ''; break;
                        case 'contact_added': icon = ''; break;
                        default: icon = '';
                    }
                    
                    html += `
                        <li style="padding: 8px 0; border-bottom: 1px solid #eee;">
                            <div style="display: flex; align-items: center;">
                                <span style="font-size: 1.5rem; margin-right: 10px;">${icon}</span>
                                <div>
                                    <div>${activity.description}</div>
                                    <small style="color: #777;">${formatDate(activity.date)}</small>
                                </div>
                            </div>
                        </li>
                    `;
                }
                
                html += '</ul>';
                recentActivitiesEl.innerHTML = html;
            }
        }
        
        async function refreshProjectsList() {
            const allProjects = await getAllProjects();
            const activeProjects = allProjects.filter(p => p.status === 'active');
            const completedProjects = allProjects.filter(p => p.status === 'completed');
            
            // Update all projects tab
            const projectsListEl = document.getElementById('projects-list');
            updateProjectsListUI(projectsListEl, allProjects);
            
            // Update active projects tab
            const activeProjectsListEl = document.getElementById('active-projects-list');
            updateProjectsListUI(activeProjectsListEl, activeProjects);
            
            // Update completed projects tab
            const completedProjectsListEl = document.getElementById('completed-projects-list');
            updateProjectsListUI(completedProjectsListEl, completedProjects);
        }
        
        async function updateProjectsListUI(element, projects) {
            if (projects.length === 0) {
                element.innerHTML = '<p>No projects found.</p>';
                return;
            }
            
            let html = '';
            
            for (const project of projects) {
                const donations = await getProjectDonations(project.id);
                const expenses = await getProjectExpenses(project.id);
                const milestones = await getProjectMilestones(project.id);
                
                const totalRaised = donations.reduce((sum, d) => sum + d.amount, 0);
                const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
                const progress = (project.goal > 0) ? Math.min(100, Math.round((totalRaised / project.goal) * 100)) : 0;
                
                let iconClass = '';
                switch (project.type) {
                    case 'water': iconClass = ''; break;
                    case 'orphan': iconClass = ''; break;
                    case 'education': iconClass = ''; break;
                    case 'tree': iconClass = ''; break;
                    case 'masjid': iconClass = ''; break;
                    case 'food': iconClass = ''; break;
                    case 'healthcare': iconClass = ''; break;
                    default: iconClass = '';
                }
                
                html += `
                    <div class="project-card">
                        <div class="project-header">
                            <h3>${iconClass} ${project.name}</h3>
                        </div>
                        <div class="project-body">
                            <p>${project.description.length > 150 ? project.description.substring(0, 150) + '...' : project.description}</p>
                            
                            <div style="margin: 15px 0;">
                                <div class="progress-container">
                                    <div class="progress-bar" style="width: ${progress}%"></div>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                    <small>0%</small>
                                    <small>${progress}%</small>
                                    <small>100%</small>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                                <div>
                                    <strong>Goal:</strong><br>
                                    ${formatCurrency(project.goal)}
                                </div>
                                <div>
                                    <strong>Raised:</strong><br>
                                    ${formatCurrency(totalRaised)}
                                </div>
                                <div>
                                    <strong>Expenses:</strong><br>
                                    ${formatCurrency(totalExpenses)}
                                </div>
                                <div>
                                    <strong>Balance:</strong><br>
                                    ${formatCurrency(totalRaised - totalExpenses)}
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <strong>Location:</strong> ${project.location || 'Not specified'}<br>
                                <strong>Impact:</strong> ${project.impact || 0} people<br>
                                <strong>Created:</strong> ${formatDate(project.created)}<br>
                                <strong>Status:</strong> ${project.status.charAt(0).toUpperCase() + project.status.slice(1)}
                                ${project.completedDate ? `<br><strong>Completed:</strong> ${formatDate(project.completedDate)}` : ''}
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <strong>Latest activity:</strong><br>
                                ${milestones.length > 0 
                                    ? `${milestones.sort((a, b) => new Date(b.date) - new Date(a.date)).title} (${formatDate(milestones.sort((a, b) => new Date(b.date) - new Date(a.date)).date)})`
                                    : 'No milestones recorded yet'}
                            </div>
                        </div>
                        <div class="project-footer">
                            <div>
                                ${project.status === 'active' ? `<button class="btn btn-success" onclick="markProjectCompleted(${project.id})">Mark Completed</button>` : ''}
                            </div>
                            <button class="btn btn-primary" onclick="openProjectDetails(${project.id})">View Details</button>
                        </div>
                    </div>
                `;
            }
            
            element.innerHTML = html;
        }
        
        async function refreshContactsList() {
            const contacts = await getAllContacts();
            const contactsListEl = document.getElementById('contacts-list');
            
            if (contacts.length === 0) {
                contactsListEl.innerHTML = '<p>No contacts found. Add new contacts by creating donations or adding them manually.</p>';
                return;
            }
            
            let html = '';
            
            for (const contact of contacts) {
                let iconClass = '';
                switch (contact.type) {
                    case 'donor': iconClass = ''; break;
                    case 'volunteer': iconClass = ''; break;
                    case 'beneficiary': iconClass = ''; break;
                    case 'partner': iconClass = ''; break;
                    default: iconClass = '';
                }
                
                html += `
                    <div class="contact-card">
                        <h4>${iconClass} ${contact.name}</h4>
                        ${contact.email ? `<p><strong>Email:</strong> ${contact.email}</p>` : ''}
                        ${contact.phone ? `<p><strong>Phone:</strong> ${contact.phone}</p>` : ''}
                        <p><strong>Type:</strong> ${contact.type.charAt(0).toUpperCase() + contact.type.slice(1)}</p>
                        ${contact.notes ? `<p><strong>Notes:</strong> ${contact.notes}</p>` : ''}
                        <p><strong>Added:</strong> ${formatDate(contact.created)}</p>
                    </div>
                `;
            }
            
            contactsListEl.innerHTML = html;
        }
        
        async function openProjectDetails(projectId) {
            currentProjectId = projectId;
            const project = await getProject(projectId);
            const donations = await getProjectDonations(projectId);
            const expenses = await getProjectExpenses(projectId);
            
            const totalDonations = donations.reduce((sum, d) => sum + d.amount, 0);
            const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
            const progress = (project.goal > 0) ? Math.min(100, Math.round((totalDonations / project.goal) * 100)) : 0;
            
            // Project details
            let iconClass = '';
            switch (project.type) {
                case 'water': iconClass = ''; break;
                case 'orphan': iconClass = ''; break;
                case 'education': iconClass = ''; break;
                case 'tree': iconClass = ''; break;
                case 'masjid': iconClass = ''; break;
                case 'food': iconClass = ''; break;
                case 'healthcare': iconClass = ''; break;
                default: iconClass = '';
            }
            
            let projectDetailsHTML = `
                <h2>${iconClass} ${project.name}</h2>
                <p>${project.description}</p>
                
                <div style="margin: 20px 0;">
                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <small>0%</small>
                        <small>${progress}%</small>
                        <small>100%</small>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-number">${formatCurrency(project.goal)}</div>
                        <div class="stat-label">Target Amount</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${formatCurrency(totalDonations)}</div>
                        <div class="stat-label">Total Raised</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${formatCurrency(totalExpenses)}</div>
                        <div class="stat-label">Total Expenses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${formatCurrency(totalDonations - totalExpenses)}</div>
                        <div class="stat-label">Remaining Balance</div>
                    </div>
                </div>
                
                <div>
                    <strong>Status:</strong> ${project.status.charAt(0).toUpperCase() + project.status.slice(1)}<br>
                    <strong>Type:</strong> ${project.type.charAt(0).toUpperCase() + project.type.slice(1)}<br>
                    <strong>Location:</strong> ${project.location || 'Not specified'}<br>
                    <strong>Expected Impact:</strong> ${project.impact || 0} people<br>
                    <strong>Created:</strong> ${formatDate(project.created)}<br>
                    ${project.completedDate ? `<strong>Completed:</strong> ${formatDate(project.completedDate)}` : ''}
                </div>
                
                ${project.status === 'active' ? `<button class="btn btn-success" style="margin-top: 20px;" onclick="markProjectCompleted(${project.id})">Mark Project as Completed</button>` : ''}
            `;
            
            document.getElementById('project-details-content').innerHTML = projectDetailsHTML;
            
            // Reset active tab
            document.querySelectorAll('[data-project-tab]').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.project-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Set first tab as active
            document.querySelector('[data-project-tab="donations"]').classList.add('active');
            document.getElementById('donations-tab').classList.add('active');
            
            // Load donations
            await loadProjectDonations(projectId);
            
            // Open modal
            openModal('view-project-modal');
        }
        
        async function loadProjectDonations(projectId) {
            const donations = await getProjectDonations(projectId);
            const donationsListEl = document.getElementById('donations-list');
            
            if (donations.length === 0) {
                donationsListEl.innerHTML = '<p>No donations recorded yet.</p>';
                return;
            }
            
            donations.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Donor</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const donation of donations) {
                html += `
                    <tr>
                        <td>${donation.donorName}</td>
                        <td>${formatCurrency(donation.amount)}</td>
                        <td>${formatDate(donation.date)}</td>
                        <td>${donation.notes || '-'}</td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>Total</th>
                            <th>${formatCurrency(donations.reduce((sum, d) => sum + d.amount, 0))}</th>
                            <th colspan="2"></th>
                        </tr>
                    </tfoot>
                </table>
            `;
            
            donationsListEl.innerHTML = html;
        }
        
        async function loadProjectExpenses(projectId) {
            const expenses = await getProjectExpenses(projectId);
            const expensesListEl = document.getElementById('expenses-list');
            
            if (expenses.length === 0) {
                expensesListEl.innerHTML = '<p>No expenses recorded yet.</p>';
                return;
            }
            
            expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const expense of expenses) {
                html += `
                    <tr>
                        <td>${expense.title}</td>
                        <td>${formatCurrency(expense.amount)}</td>
                        <td>${formatDate(expense.date)}</td>
                        <td>${expense.notes || '-'}</td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>Total</th>
                            <th>${formatCurrency(expenses.reduce((sum, e) => sum + e.amount, 0))}</th>
                            <th colspan="2"></th>
                        </tr>
                    </tfoot>
                </table>
            `;
            
            expensesListEl.innerHTML = html;
        }
        
        async function loadProjectMilestones(projectId) {
            const milestones = await getProjectMilestones(projectId);
            const milestonesListEl = document.getElementById('milestones-list');
            
            if (milestones.length === 0) {
                milestonesListEl.innerHTML = '<p>No milestones recorded yet.</p>';
                return;
            }
            
            milestones.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = `
                <div class="timeline" style="position: relative; margin-left: 20px;">
            `;
            
            for (const milestone of milestones) {
                html += `
                    <div class="timeline-item" style="position: relative; padding-bottom: 20px; padding-left: 30px; border-left: 2px solid var(--primary);">
                        <div class="timeline-marker" style="position: absolute; left: -10px; width: 20px; height: 20px; border-radius: 50%; background-color: var(--primary);"></div>
                        <div class="timeline-content" style="padding: 10px; background-color: rgba(255,255,255,0.1); border-radius: 5px;">
                            <h4>${milestone.title}</h4>
                            <p><strong>Date:</strong> ${formatDate(milestone.date)}</p>
                            <p>${milestone.description}</p>
                        </div>
                    </div>
                `;
            }
            
            html += `</div>`;
            milestonesListEl.innerHTML = html;
        }
        
        async function loadProjectPhotos(projectId) {
            const photos = await getProjectPhotos(projectId);
            const photosGalleryEl = document.getElementById('photos-gallery');
            
            if (photos.length === 0) {
                photosGalleryEl.innerHTML = '<p>No photos uploaded yet.</p>';
                return;
            }
            
            let html = '';
            
            for (const photo of photos) {
                html += `
                    <div class="gallery-item" onclick="viewPhoto(${photo.id})">
                        <img src="${photo.data}" alt="${photo.title}">
                        <div class="overlay">
                            ${photo.title}
                        </div>
                    </div>
                `;
            }
            
            photosGalleryEl.innerHTML = html;
        }
        
        async function loadProjectNotes(projectId) {
            const notes = await getProjectNotes(projectId);
            const notesListEl = document.getElementById('notes-list');
            
            if (notes.length === 0) {
                notesListEl.innerHTML = '<p>No notes added yet.</p>';
                return;
            }
            
            notes.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '';
            
            for (const note of notes) {
                html += `
                    <div class="card" style="margin-bottom: 15px;">
                        <h4>${note.title}</h4>
                        <p style="white-space: pre-line;">${note.content}</p>
                        <small style="color: #777;">${formatDate(note.date)}</small>
                    </div>
                `;
            }
            
            notesListEl.innerHTML = html;
        }
        
        async function viewPhoto(photoId) {
            const photo = await getFromStore(PHOTOS_STORE, photoId);
            
            if (photo) {
                const html = `
                    <div style="text-align: center;">
                        <h3>${photo.title}</h3>
                        <p><small>${formatDate(photo.date)}</small></p>
                        ${photo.description ? `<p>${photo.description}</p>` : ''}
                        <div style="margin: 20px 0;">
                            <img src="${photo.data}" alt="${photo.title}" style="max-width: 100%; max-height: 70vh;">
                        </div>
                    </div>
                `;
                
                document.getElementById('photo-details').innerHTML = html;
                openModal('view-photo-modal');
            }
        }
        
        function openAddDonationForm() {
            document.getElementById('add-donation-form').style.display = 'block';
            document.getElementById('donation-date').valueAsDate = new Date();
        }
        
        function openAddExpenseForm() {
            document.getElementById('add-expense-form').style.display = 'block';
            document.getElementById('expense-date').valueAsDate = new Date();
        }
        
        function openAddMilestoneForm() {
            document.getElementById('add-milestone-form').style.display = 'block';
            document.getElementById('milestone-date').valueAsDate = new Date();
        }
        
        function openAddPhotoForm() {
            document.getElementById('add-photo-form').style.display = 'block';
            document.getElementById('photo-date').valueAsDate = new Date();
        }
        
        function openAddNoteForm() {
            document.getElementById('add-note-form').style.display = 'block';
        }
        
        async function markProjectCompleted(projectId) {
            if (confirm('Are you sure you want to mark this project as completed?')) {
                await completeProject(projectId);
                
                // Refresh UI
                await refreshDashboard();
                await refreshProjectsList();
                
                // If project details modal is open, refresh it
                if (currentProjectId === projectId) {
                    await openProjectDetails(projectId);
                }
            }
        }
        
        function exportData(type) {
            let promise;
            
            switch (type) {
                case 'all':
                    promise = exportAllData();
                    break;
                case 'projects':
                    promise = exportProjectsData();
                    break;
                case 'contacts':
                    promise = exportContactsData();
                    break;
            }
            
            promise.then(data => {
                // Create file and download it
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `jariyah-projects-${type}-export-${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }).catch(error => {
                console.error('Export error:', error);
                alert('Failed to export data. Please try again.');
            });
        }
        
        async function exportAllData() {
            const projects = await getAllProjects();
            const donations = await getAllFromStore(DONATIONS_STORE);
            const expenses = await getAllFromStore(EXPENSES_STORE);
            const milestones = await getAllFromStore(MILESTONES_STORE);
            const contacts = await getAllContacts();
            const photos = await getAllFromStore(PHOTOS_STORE);
            const notes = await getAllFromStore(NOTES_STORE);
            
            return {
                projects,
                donations,
                expenses,
                milestones,
                contacts,
                photos,
                notes,
                exportDate: new Date()
            };
        }
        
        async function exportProjectsData() {
            const projects = await getAllProjects();
            const result = [];
            
            for (const project of projects) {
                const donations = await getProjectDonations(project.id);
                const expenses = await getProjectExpenses(project.id);
                const milestones = await getProjectMilestones(project.id);
                const photos = await getProjectPhotos(project.id);
                const notes = await getProjectNotes(project.id);
                
                result.push({
                    ...project,
                    donations,
                    expenses,
                    milestones,
                    photos,
                    notes
                });
            }
            
            return {
                projects: result,
                exportDate: new Date()
            };
        }
        
        async function exportContactsData() {
            const contacts = await getAllContacts();
            return {
                contacts,
                exportDate: new Date()
            };
        }
        
        function confirmClearData() {
            if (confirm('WARNING: This will permanently delete ALL data stored in this application. This action CANNOT be undone. Are you sure you want to proceed?')) {
                if (confirm('FINAL WARNING: All your projects, donations, expenses, and other data will be lost. Type "DELETE" to confirm.')) {
                    clearAllData();
                }
            }
        }
        
        async function clearAllData() {
            if (db) {
                db.close();
            }
            
            const req = indexedDB.deleteDatabase(DB_NAME);
            
            req.onsuccess = () => {
                alert('All data has been deleted. The application will reload.');
                window.location.reload();
            };
            
            req.onerror = () => {
                alert('Failed to delete data. Please try again.');
            };
        }
        
        // Event listeners
        window.addEventListener('DOMContentLoaded', async () => {
            // Initialize database
            try {
                await initDb();
                
                // Load initial data
                await refreshDashboard();
                await refreshProjectsList();
                await refreshContactsList();
                
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', () => {
                        // Update nav items
                        document.querySelectorAll('.nav-item').forEach(navItem => {
                            navItem.classList.remove('active');
                        });
                        item.classList.add('active');
                        
                        // Show corresponding section
                        const tabId = item.getAttribute('data-tab');
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        document.getElementById(tabId).classList.add('active');
                    });
                });
                
                // Projects tabs
                document.querySelectorAll('#project-tabs .tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('#project-tabs .tab').forEach(t => {
                            t.classList.remove('active');
                        });
                        tab.classList.add('active');
                        
                        const tabId = tab.getAttribute('data-tab');
                        document.querySelectorAll('#projects > div').forEach(content => {
                            content.classList.remove('active');
                        });
                        document.getElementById(tabId).classList.add('active');
                    });
                });
                
                // Project details tabs
                document.querySelectorAll('[data-project-tab]').forEach(tab => {
                    tab.addEventListener('click', async () => {
                        document.querySelectorAll('[data-project-tab]').forEach(t => {
                            t.classList.remove('active');
                        });
                        tab.classList.add('active');
                        
                        const tabId = tab.getAttribute('data-project-tab');
                        document.querySelectorAll('.project-tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        
                        const contentEl = document.getElementById(`${tabId}-tab`);
                        contentEl.classList.add('active');
                        
                        // Load tab data
                        if (currentProjectId) {
                            switch (tabId) {
                                case 'donations':
                                    await loadProjectDonations(currentProjectId);
                                    break;
                                case 'expenses':
                                    await loadProjectExpenses(currentProjectId);
                                    break;
                                case 'milestones':
                                    await loadProjectMilestones(currentProjectId);
                                    break;
                                case 'photos':
                                    await loadProjectPhotos(currentProjectId);
                                    break;
                                case 'notes':
                                    await loadProjectNotes(currentProjectId);
                                    break;
                            }
                        }
                    });
                });
                
                // Theme switcher
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelectorAll('.theme-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        option.classList.add('active');
                        
                        // Apply theme
                        const theme = option.getAttribute('data-theme');
                        document.body.className = theme !== 'default' ? `${theme}-theme` : '';
                    });
                });
                
                // Add project form
                document.getElementById('add-project-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const project = {
                        name: document.getElementById('project-name').value,
                        type: document.getElementById('project-type').value,
                        goal: parseFloat(document.getElementById('project-goal').value),
                        description: document.getElementById('project-description').value,
                        impact: parseInt(document.getElementById('project-impact').value),
                        location: document.getElementById('project-location').value
                    };
                    
                    await addProject(project);
                    
                    // Reset form
                    e.target.reset();
                    
                    // Close modal
                    closeModal('add-project-modal');
                    
                    // Refresh UI
                    await refreshDashboard();
                    await refreshProjectsList();
                });
                
                // Add contact form
                document.getElementById('add-contact-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const contact = {
                        name: document.getElementById('contact-name').value,
                        email: document.getElementById('contact-email').value,
                        phone: document.getElementById('contact-phone').value,
                        type: document.getElementById('contact-type').value,
                        notes: document.getElementById('contact-notes').value,
                        created: new Date()
                    };
                    
                    await addContact(contact);
                    
                    // Reset form
                    e.target.reset();
                    
                    // Close modal
                    closeModal('add-contact-modal');
                    
                    // Refresh UI
                    await refreshContactsList();
                });
                
                // Add donation form
                document.getElementById('donation-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const donation = {
                        projectId: currentProjectId,
                        donorName: document.getElementById('donor-name').value,
                        amount: parseFloat(document.getElementById('donation-amount').value),
                        date: new Date(document.getElementById('donation-date').value),
                        notes: document.getElementById('donation-notes').value
                    };
                    
                    await addDonation(donation);
                    
                    // Reset form
                    e.target.reset();
                    document.getElementById('add-donation-form').style.display = 'none';
                    
                    // Refresh UI
                    await loadProjectDonations(currentProjectId);
                    await refreshDashboard();
                    await refreshProjectsList();
                });
                
                // Add expense form
                document.getElementById('expense-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const expense = {
                        projectId: currentProjectId,
                        title: document.getElementById('expense-title').value,
                        amount: parseFloat(document.getElementById('expense-amount').value),
                        date: new Date(document.getElementById('expense-date').value),
                        notes: document.getElementById('expense-notes').value
                    };
                    
                    await addExpense(expense);
                    
                    // Reset form
                    e.target.reset();
                    document.getElementById('add-expense-form').style.display = 'none';
                    
                    // Refresh UI
                    await loadProjectExpenses(currentProjectId);
                    await refreshDashboard();
                    await refreshProjectsList();
                });
                
                // Add milestone form
                document.getElementById('milestone-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const milestone = {
                        projectId: currentProjectId,
                        title: document.getElementById('milestone-title').value,
                        date: new Date(document.getElementById('milestone-date').value),
                        description: document.getElementById('milestone-description').value
                    };
                    
                    await addMilestone(milestone);
                    
                    // Reset form
                    e.target.reset();
                    document.getElementById('add-milestone-form').style.display = 'none';
                    
                    // Refresh UI
                    await loadProjectMilestones(currentProjectId);
                    await refreshDashboard();
                    await refreshProjectsList();
                });
                
                // Add photo form
                document.getElementById('photo-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const fileInput = document.getElementById('photo-file');
                    if (fileInput.files.length === 0) {
                        alert('Please select a photo to upload.');
                        return;
                    }
                    
                    const file = fileInput.files;
                    const reader = new FileReader();
                    
                    reader.onload = async (event) => {
                        const photo = {
                            projectId: currentProjectId,
                            title: document.getElementById('photo-title').value,
                            date: new Date(document.getElementById('photo-date').value),
                            description: document.getElementById('photo-description').value,
                            data: event.target.result
                        };
                        
                        await addPhoto(photo);
                        
                        // Reset form
                        e.target.reset();
                        document.getElementById('add-photo-form').style.display = 'none';
                        
                        // Refresh UI
                        await loadProjectPhotos(currentProjectId);
                    };
                    
                    reader.readAsDataURL(file);
                });
                
                // Add note form
                document.getElementById('note-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const note = {
                        projectId: currentProjectId,
                        title: document.getElementById('note-title').value,
                        content: document.getElementById('note-content').value,
                        date: new Date()
                    };
                    
                    await addNote(note);
                    
                    // Reset form
                    e.target.reset();
                    document.getElementById('add-note-form').style.display = 'none';
                    
                    // Refresh UI
                    await loadProjectNotes(currentProjectId);
                });
                
                // Close modals when clicking outside
                window.addEventListener('click', (event) => {
                    document.querySelectorAll('.modal').forEach(modal => {
                        if (event.target === modal) {
                            closeModal(modal.id);
                        }
                    });
                });
                
                // Contact search
                document.getElementById('contact-search').addEventListener('input', async (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const contacts = await getAllContacts();
                    
                    const filteredContacts = contacts.filter(contact => 
                        contact.name.toLowerCase().includes(searchTerm) ||
                        (contact.email && contact.email.toLowerCase().includes(searchTerm)) ||
                        (contact.phone && contact.phone.toLowerCase().includes(searchTerm)) ||
                        (contact.notes && contact.notes.toLowerCase().includes(searchTerm))
                    );
                    
                    const contactsListEl = document.getElementById('contacts-list');
                    
                    if (filteredContacts.length === 0) {
                        contactsListEl.innerHTML = '<p>No contacts found matching your search.</p>';
                        return;
                    }
                    
                    let html = '';
                    
                    for (const contact of filteredContacts) {
                        let iconClass = '';
                        switch (contact.type) {
                            case 'donor': iconClass = ''; break;
                            case 'volunteer': iconClass = ''; break;
                            case 'beneficiary': iconClass = ''; break;
                            case 'partner': iconClass = ''; break;
                            default: iconClass = '';
                        }
                        
                        html += `
                            <div class="contact-card">
                                <h4>${iconClass} ${contact.name}</h4>
                                ${contact.email ? `<p><strong>Email:</strong> ${contact.email}</p>` : ''}
                                ${contact.phone ? `<p><strong>Phone:</strong> ${contact.phone}</p>` : ''}
                                <p><strong>Type:</strong> ${contact.type.charAt(0).toUpperCase() + contact.type.slice(1)}</p>
                                ${contact.notes ? `<p><strong>Notes:</strong> ${contact.notes}</p>` : ''}
                                <p><strong>Added:</strong> ${formatDate(contact.created)}</p>
                            </div>
                        `;
                    }
                    
                    contactsListEl.innerHTML = html;
                });
                
            } catch (error) {
                console.error('Initialization error:', error);
                alert('Failed to initialize the application. Please try refreshing the page.');
            }
        });
        
        // Global functions needed for onclick events
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.openProjectDetails = openProjectDetails;
        window.markProjectCompleted = markProjectCompleted;
        window.openAddDonationForm = openAddDonationForm;
        window.openAddExpenseForm = openAddExpenseForm;
        window.openAddMilestoneForm = openAddMilestoneForm;
        window.openAddPhotoForm = openAddPhotoForm;
        window.openAddNoteForm = openAddNoteForm;
        window.viewPhoto = viewPhoto;
        window.exportData = exportData;
        window.confirmClearData = confirmClearData;



document.addEventListener('DOMContentLoaded', async function() {
// Wait for database initialization
setTimeout(async () => {
try {
if (!db) {
console.error("Database not initialized");
return;
}

            // Sample project types
            const projectTypes = ['water', 'orphan', 'education', 'tree', 'masjid', 'food', 'healthcare'];
            
            // Sample locations
            const locations = [
                'Karachi, Pakistan', 'Lahore, Pakistan', 'Islamabad, Pakistan', 
                'Peshawar, Pakistan', 'Quetta, Pakistan', 'Multan, Pakistan',
                'Faisalabad, Pakistan', 'Swat, Pakistan', 'Gilgit, Pakistan',
                'Hyderabad, Pakistan', 'Sialkot, Pakistan', 'Bahawalpur, Pakistan'
            ];
            
            // Sample donor names
            const donorNames = [
                'Ahmed Khan', 'Fatima Ali', 'Muhammad Usman', 'Aisha Malik',
                'Hassan Ahmed', 'Zainab Qureshi', 'Omar Farooq', 'Amina Haider',
                'Bilal Siddiqui', 'Sana Rashid', 'Imran Javed', 'Maryam Shah',
                'Tariq Mehmood', 'Nadia Hussain', 'Yasir Iqbal', 'Saima Kamal'
            ];
            
            // Sample project names and descriptions
            const projectTemplates = [
                {
                    type: 'water',
                    names: ['Community Well Project', 'Clean Water Initiative', 'Village Water Supply', 'Water Access Program'],
                    descriptions: [
                        'Constructing a well to provide clean water access to a remote village where residents currently walk 3km daily to fetch water.',
                        'Installing water filtration systems in a community affected by waterborne diseases, serving approximately 500 families.',
                        'Building a solar-powered water pump system to improve water accessibility in a drought-prone area.',
                        'Digging deep bore wells to provide sustainable clean water access to multiple villages in the region.'
                    ]
                },
                {
                    type: 'orphan',
                    names: ['Orphan Care Program', 'Children\'s Future Initiative', 'Orphan Support Project', 'Youth Hope Foundation'],
                    descriptions: [
                        'Providing monthly stipends, education, healthcare and basic necessities for 30 orphaned children.',
                        'Sponsoring education, medical care, and living expenses for orphans to ensure they have opportunities for a better future.',
                        'Supporting orphaned children with education, nutrition, healthcare, and psychosocial support to help them thrive.',
                        'Comprehensive program providing housing, education, healthcare, and life skills training for orphaned children.'
                    ]
                },
                {
                    type: 'education',
                    names: ['Knowledge For All', 'Education Empowerment', 'School Construction Project', 'Learning Center Initiative'],
                    descriptions: [
                        'Building a primary school in an underserved area to provide education to approximately 150 children who currently have no access to schooling.',
                        'Renovating and equipping a dilapidated school building with modern facilities, books, and learning materials.',
                        'Providing scholarships, books, and school supplies to underprivileged students to reduce dropout rates.',
                        'Establishing a community learning center with a library and computer lab to support education for all ages.'
                    ]
                },
                {
                    type: 'tree',
                    names: ['Green Revival Project', 'Community Reforestation', 'Urban Tree Planting', 'Environmental Sustainability Initiative'],
                    descriptions: [
                        'Planting 5,000 indigenous trees to restore a deforested area and combat soil erosion in the local community.',
                        'Community-based tree planting program to increase green cover and provide fruit trees for sustainable nutrition.',
                        'Urban greening project to plant trees along roadways and in public spaces to improve air quality and reduce urban heat.',
                        'Establishing a community nursery and planting program to support long-term environmental sustainability.'
                    ]
                },
                {
                    type: 'masjid',
                    names: ['Masjid Construction Project', 'Community Mosque Renovation', 'Village Masjid Development', 'Jamia Masjid Expansion'],
                    descriptions: [
                        'Building a new masjid to serve a community of 300 families who currently have no nearby place of worship.',
                        'Renovating an old masjid structure to make it safer, more accessible, and better equipped for the community.',
                        'Expanding an existing masjid to accommodate the growing number of worshippers and add educational facilities.',
                        'Constructing a comprehensive Islamic center with prayer hall, classrooms, and community facilities.'
                    ]
                },
                {
                    type: 'food',
                    names: ['Hunger Relief Program', 'Community Food Bank', 'Ramadan Food Distribution', 'Sustainable Food Security'],
                    descriptions: [
                        'Providing monthly food packages to 100 vulnerable families facing food insecurity in urban slum areas.',
                        'Establishing a community food bank to provide emergency food assistance to families in need throughout the year.',
                        'Distributing iftar and suhoor packages during Ramadan to ensure food security for underprivileged families.',
                        'Implementing sustainable agriculture projects to help communities achieve long-term food security.'
                    ]
                },
                {
                    type: 'healthcare',
                    names: ['Medical Aid Initiative', 'Community Health Clinic', 'Rural Healthcare Project', 'Health Outreach Program'],
                    descriptions: [
                        'Establishing a basic healthcare clinic to provide medical services to 5 remote villages with no current healthcare access.',
                        'Running mobile medical camps to provide check-ups, treatments, and medicines to underserved communities.',
                        'Funding critical surgeries and medical treatments for those who cannot afford essential healthcare.',
                        'Training community health workers to provide basic healthcare services and health education in rural areas.'
                    ]
                }
            ];
            
            // Sample expense categories
            const expenseCategories = [
                { type: 'water', expenses: ['Drilling equipment', 'Water pipes', 'Filtration system', 'Pump installation', 'Labor costs', 'Transport'] },
                { type: 'orphan', expenses: ['Education fees', 'Clothing supplies', 'Food provisions', 'Healthcare', 'Housing maintenance', 'Administrative costs'] },
                { type: 'education', expenses: ['Building materials', 'Furniture', 'Books and supplies', 'Teacher salaries', 'Technology equipment', 'Uniforms'] },
                { type: 'tree', expenses: ['Saplings', 'Gardening tools', 'Irrigation system', 'Fertilizer', 'Labor costs', 'Transport'] },
                { type: 'masjid', expenses: ['Construction materials', 'Electrical work', 'Plumbing', 'Interior furnishing', 'Labor costs', 'Architectural services'] },
                { type: 'food', expenses: ['Food supplies', 'Packaging materials', 'Storage facilities', 'Transport', 'Distribution costs', 'Cold storage'] },
                { type: 'healthcare', expenses: ['Medical equipment', 'Medicines', 'Staff salaries', 'Facility rent', 'Ambulance service', 'Medical disposal'] }
            ];
            
            // Sample milestone templates
            const milestoneTemplates = [
                { type: 'water', milestones: ['Site selection completed', 'Drilling began', 'Water source reached', 'Pump installation completed', 'Water quality testing passed', 'Project inauguration ceremony'] },
                { type: 'orphan', milestones: ['Children identified and registered', 'Initial needs assessment completed', 'Education enrollment complete', 'Quarterly health check-ups conducted', 'Skills training program started', 'Annual progress review'] },
                { type: 'education', milestones: ['Land acquired', 'Foundation laid', 'Building structure completed', 'Classrooms furnished', 'Teachers hired', 'School opening ceremony'] },
                { type: 'tree', milestones: ['Site preparation completed', 'First 1000 trees planted', 'Irrigation system installed', 'Second phase planting completed', 'Community maintenance training conducted', 'Six-month growth assessment'] },
                { type: 'masjid', milestones: ['Land purchased', 'Foundation completed', 'Structure erected', 'Interior work begun', 'Finishing and furnishing completed', 'Opening ceremony'] },
                { type: 'food', milestones: ['Beneficiary identification completed', 'First distribution completed', 'Storage facility secured', 'Monthly distribution system established', 'Additional donors secured', 'Program expansion to new area'] },
                { type: 'healthcare', milestones: ['Location secured', 'Equipment procured', 'Staff recruited', 'Facility set up completed', 'First patients treated', 'Community health education program launched'] }
            ];
            
            // Sample note content
            const noteContents = [
                'Meeting with local leaders went well. They are supportive of the project and have offered to help with community mobilization.',
                'Need to follow up with additional donors to secure remaining funding for phase two of the project.',
                'Local government officials visited the project site today. They were impressed with progress and offered additional support.',
                'Community feedback session revealed some concerns about project sustainability. Need to develop better maintenance plan.',
                'Volunteer team has grown to 15 members. Training session scheduled for next week.',
                'Supply chain issues causing slight delays. Working on alternative sources for materials.',
                'Project impact assessment shows excellent results so far. Will compile data for donor report next week.',
                'Community ownership of the project is increasing. Local committee formed to oversee maintenance.'
            ];
            
            // Create sample projects
            let projectIds = [];
            for (let i = 0; i < 20; i++) {
                // Select random type
                const typeIndex = Math.floor(Math.random() * projectTypes.length);
                const type = projectTypes[typeIndex];
                
                // Find corresponding template
                const template = projectTemplates.find(t => t.type === type);
                
                // Select random name and description
                const nameIndex = Math.floor(Math.random() * template.names.length);
                const descIndex = Math.floor(Math.random() * template.descriptions.length);
                
                // Random location
                const location = locations[Math.floor(Math.random() * locations.length)];
                
                // Random dates for creation (between 1-12 months ago)
                const createdDate = new Date();
                createdDate.setMonth(createdDate.getMonth() - Math.floor(Math.random() * 12) - 1);
                
                // Random status (80% active, 20% completed)
                const status = Math.random() > 0.2 ? 'active' : 'completed';
                
                // Random goal amount between $5,000 and $50,000
                const goal = Math.floor(Math.random() * 45000) + 5000;
                
                // Random impact between 50 and 1000 people
                const impact = Math.floor(Math.random() * 950) + 50;
                
                // Create project
                const project = {
                    name: template.names[nameIndex],
                    type,
                    description: template.descriptions[descIndex],
                    location,
                    goal,
                    impact,
                    created: createdDate,
                    status,
                    completedDate: status === 'completed' ? new Date(createdDate.getTime() + Math.random() * (new Date() - createdDate)) : null
                };
                
                // Add project to database
                const tx = db.transaction(PROJECTS_STORE, 'readwrite');
                const store = tx.objectStore(PROJECTS_STORE);
                const projectId = await new Promise((resolve, reject) => {
                    const request = store.add(project);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
                
                projectIds.push(projectId);
                
                // Log activity for project creation
                await addActivity({
                    projectId,
                    type: 'project_created',
                    description: `Project "${project.name}" created`,
                    date: createdDate
                });
            }
            
            // Add donations, expenses, milestones, notes, and photos to each project
            for (const projectId of projectIds) {
                const project = await getProject(projectId);
                
                // Get matching expense categories and milestones for this project type
                const expenseCategory = expenseCategories.find(ec => ec.type === project.type);
                const milestoneTemplate = milestoneTemplates.find(mt => mt.type === project.type);
                
                // Calculate dates between project creation and now (or completion date)
                const endDate = project.status === 'completed' ? project.completedDate : new Date();
                const dateRange = endDate - project.created;
                
                // Add 5-15 donations per project
                const donationsCount = Math.floor(Math.random() * 11) + 5;
                for (let i = 0; i < donationsCount; i++) {
                    // Random donor
                    const donor = donorNames[Math.floor(Math.random() * donorNames.length)];
                    
                    // Random amount between $100 and $5,000
                    const amount = Math.floor(Math.random() * 4900) + 100;
                    
                    // Random date between project creation and now/completion
                    const donationDate = new Date(project.created.getTime() + Math.random() * dateRange);
                    
                    // Add donation
                    const donation = {
                        projectId,
                        donorName: donor,
                        amount,
                        date: donationDate,
                        notes: Math.random() > 0.7 ? 'Monthly donation' : Math.random() > 0.5 ? 'One-time contribution' : ''
                    };
                    
                    await addToStore(DONATIONS_STORE, donation);
                    
                    // Add donor as contact if not already in list
                    const contacts = await getByIndex(CONTACTS_STORE, 'name', donor);
                    if (contacts.length === 0) {
                        await addToStore(CONTACTS_STORE, {
                            name: donor,
                            email: donor.toLowerCase().replace(' ', '.') + '@example.com',
                            phone: '+92' + Math.floor(Math.random() * 10000000000),
                            type: 'donor',
                            created: donationDate,
                            notes: `Added from donation to ${project.name}`
                        });
                    }
                    
                    // Log activity
                    await addActivity({
                        projectId,
                        type: 'donation_received',
                        description: `Donation of $${amount} received from ${donor}`,
                        date: donationDate
                    });
                }
                
                // Add 3-8 expenses per project
                const expensesCount = Math.floor(Math.random() * 6) + 3;
                for (let i = 0; i < expensesCount; i++) {
                    // Random expense from category
                    const expenseTitle = expenseCategory.expenses[Math.floor(Math.random() * expenseCategory.expenses.length)];
                    
                    // Random amount between $200 and $10,000
                    const amount = Math.floor(Math.random() * 9800) + 200;
                    
                    // Random date between project creation and now/completion
                    const expenseDate = new Date(project.created.getTime() + Math.random() * dateRange);
                    
                    // Add expense
                    const expense = {
                        projectId,
                        title: expenseTitle,
                        amount,
                        date: expenseDate,
                        notes: Math.random() > 0.6 ? `Payment for ${expenseTitle.toLowerCase()}` : ''
                    };
                    
                    await addToStore(EXPENSES_STORE, expense);
                    
                    // Log activity
                    await addActivity({
                        projectId,
                        type: 'expense_added',
                        description: `Expense of $${amount} added for ${expenseTitle}`,
                        date: expenseDate
                    });
                }
                
                // Add 3-6 milestones per project
                const milestonesCount = Math.min(Math.floor(Math.random() * 4) + 3, milestoneTemplate.milestones.length);
                const selectedMilestones = [...milestoneTemplate.milestones].slice(0, milestonesCount);
                
                for (let i = 0; i < selectedMilestones.length; i++) {
                    // Calculate milestone date - earlier milestones come first
                    const progress = (i + 1) / selectedMilestones.length;
                    const milestoneDate = new Date(project.created.getTime() + (dateRange * progress));
                    
                    // Add milestone
                    const milestone = {
                        projectId,
                        title: selectedMilestones[i],
                        date: milestoneDate,
                        description: `Successfully completed ${selectedMilestones[i].toLowerCase()}. Project is progressing ${Math.round(progress * 100)}% towards completion.`
                    };
                    
                    await addToStore(MILESTONES_STORE, milestone);
                    
                    // Log activity
                    await addActivity({
                        projectId,
                        type: 'milestone_added',
                        description: `Milestone reached: ${selectedMilestones[i]}`,
                        date: milestoneDate
                    });
                }
                
                // Add 2-4 notes per project
                const notesCount = Math.floor(Math.random() * 3) + 2;
                for (let i = 0; i < notesCount; i++) {
                    // Random note content
                    const content = noteContents[Math.floor(Math.random() * noteContents.length)];
                    
                    // Random date between project creation and now/completion
                    const noteDate = new Date(project.created.getTime() + Math.random() * dateRange);
                    
                    // Add note
                    const note = {
                        projectId,
                        title: `Update - ${formatDate(noteDate)}`,
                        content,
                        date: noteDate
                    };
                    
                    await addToStore(NOTES_STORE, note);
                    
                    // Log activity
                    await addActivity({
                        projectId,
                        type: 'note_added',
                        description: `New note added: Update - ${formatDate(noteDate)}`,
                        date: noteDate
                    });
                }
            }
            
            // Add some additional contacts
            const additionalContacts = [
                { name: 'Abdullah Mohammed', type: 'volunteer', email: 'abdullah@example.com', phone: '+9212345678', notes: 'Regular volunteer for food distribution' },
                { name: 'Rabia Ahmed', type: 'partner', email: 'rabia@partnerorg.org', phone: '+9287654321', notes: 'Representative from partner organization' },
                { name: 'Khalid Mahmood', type: 'beneficiary', notes: 'Family of 5, received support from multiple projects' },
                { name: 'Samina Welfare Foundation', type: 'partner', email: 'contact@swf.org', phone: '+9255555555', notes: 'Local NGO partner for rural projects' }
            ];
            
            for (const contact of additionalContacts) {
                contact.created = new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000); // Random date within last 30 days
                await addToStore(CONTACTS_STORE, contact);
            }
            
            console.log('Sample data added successfully!');
            
            // Refresh UI
            await refreshDashboard();
            await refreshProjectsList();
            await refreshContactsList();
            
            alert('20 sample projects with donations, expenses, milestones, and notes have been added successfully!');
        } catch (error) {
            console.error('Error adding sample data:', error);
            alert('Failed to add sample data. See console for details.');
        }
    }, 1000); // Wait 1 second for DB to initialize
    });

function formatDate(date) {
return new Date(date).toLocaleDateString('en-US', {
year: 'numeric',
month: 'short',
day: 'numeric'
});
}


</script>
    </body>
</html>
